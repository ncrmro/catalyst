#!/usr/bin/env bash
# kubectl wrapper for local K3s cluster
# Automatically sets KUBECONFIG to local cluster configuration

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
KUBECONFIG_PATH="$PROJECT_ROOT/web/.kube/config"

# Check if kubeconfig exists
if [[ ! -f "$KUBECONFIG_PATH" ]]; then
    echo "ERROR: Kubeconfig not found: web/.kube/config" >&2
    echo "Run 'bin/k3s-vm setup' first" >&2
    exit 1
fi

# Export KUBECONFIG and execute kubectl with all arguments
export KUBECONFIG="$KUBECONFIG_PATH"
exec kubectl "$@"
